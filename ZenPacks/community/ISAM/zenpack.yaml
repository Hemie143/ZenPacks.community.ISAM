name: ZenPacks.community.ISAM

zProperties:
  zISAMUsername:
    category: ISAM

  zISAMPassword:
    category: ISAM
    type: password

classes:
  ISAMDevice:
    base: [zenpacklib.Device]
    label: ISAM Device
    properties:
      model:
        type: string
        label: Model

  ISAMReverseProxy:
    base: [zenpacklib.Component]
    label: ISAM Reverse Proxy
    properties:
      status:
        type: string
        label: Status
      started:
        type: string
        label: Started
      enabled:
        type: string
        label: Enabled

  ISAMJunction:
    base: [zenpacklib.Component]
    label: ISAM Junction
    properties:
      rp_name:
        type: string
        label: Reverse Proxy Name

  ISAMInterface:
    base: [zenpacklib.Component]
    label: ISAM Interface
    properties:
      enabled:
        type: string
        label: Enabled
      ipv4:
        type: string
        label: IPv4 address

  ISAMFileSystem:
    base: [zenpacklib.Component]
    label: File System
    monitoring_templates: [ISAMFileSystem]
    properties:
      size:
        label: Size
        renderer: Zenoss.render.bytesString

device_classes:
  /Security/ISAM:
    zProperties:
      zPythonClass: ZenPacks.community.ISAM.ISAMDevice
      zSnmpMonitorIgnore: true
      zCollectorPlugins:
        - zenoss.snmp.NewDeviceMap
        - zenoss.snmp.DeviceMap
        - zenoss.snmp.SnmpV3EngineIdMap
        - zenoss.snmp.InterfaceMap
        - zenoss.snmp.RouteMap
        - zenoss.snmp.HRFileSystemMap
        - zenoss.snmp.HRSWRunMap
        - zenoss.snmp.HRSWInstalledMap
        - zenoss.snmp.HSRPMap
        - zenoss.snmp.CpuMap
        - zenoss.snmp.IpServiceMap
        - community.json.ISAM
      zDeviceTemplates:
        - Device
        - ISAMDevice

    templates:
      ISAMDevice:
        targetPythonClass: ZenPacks.community.ISAM.ISAMDevice

        datasources:
          cpu:
            type: Python
            plugin_classname: ZenPacks.community.ISAM.dsplugins.ISAMDevice.ISAMDevice

            datapoints:
              user_cpu: GAUGE
              system_cpu: GAUGE
              idle_cpu: GAUGE

          memory:
            type: Python
            plugin_classname: ZenPacks.community.ISAM.dsplugins.ISAMDevice.ISAMDevice

            datapoints:
              used: GAUGE
              free: GAUGE
              total: GAUGE
              used_perc: GAUGE

        graphs:
          CPU:
            units: percent
            width: 1000
            miny: 0
            maxy: 100

            graphpoints:
              User CPU percentage:
                dpName: cpu_user_cpu
                lineType: AREA
              System CPU percentage:
                dpName: cpu_system_cpu
                lineType: AREA
                stacked: true
              Idle CPU percentage:
                dpName: cpu_idle_cpu
                lineType: AREA
                stacked: true

          Memory:
            units: bytes
            width: 1000
            miny: 0
            base: true

            graphpoints:
              Memory usage (MB):
                dpName: memory_used
                lineType: AREA

          Memory Percentage:
            units: percent
            width: 1000
            miny: 0
            maxy: 100

            graphpoints:
              Memory usage (percentage):
                dpName: memory_used_perc
                lineType: AREA

      ISAMReverseProxy:
        datasources:
          status:
            type: Python
            plugin_classname: ZenPacks.community.ISAM.dsplugins.ISAMReverseProxy.RPStatus
            cycletime: 60

            datapoints:
              status:
                rrdtype: GAUGE

          throughput:
            type: Python
            plugin_classname: ZenPacks.community.ISAM.dsplugins.ISAMReverseProxy.RPThroughput
            cycletime: 600

            datapoints:
              requests:
                rrdtype: GAUGE
                createCmd: 'RRA:AVERAGE:0.5:1:600
                  RRA:AVERAGE:0.5:6:600
                  RRA:AVERAGE:0.5:24:600
                  RRA:AVERAGE:0.5:288:600
                  RRA:MAX:0.5:6:600
                  RRA:MAX:0.5:24:600
                  RRA:MAX:0.5:288:600
                  RRA:LAST:0.5:1:600
                  RRA:LAST:0.5:6:600
                  RRA:LAST:0.5:24:600
                  RRA:LAST:0.5:288:600'

        graphs:
          Status:
            width: 1000
            miny: 0
            maxy: 2

            graphpoints:
              status:
                dpName: status_status

          Throughput:
            units: requests
            width: 1000
            miny: 0

            graphpoints:
              requests:
                dpName: throughput_requests
                cFunc: LAST

      ISAMInterface:
        datasources:
          interface:
            type: Python
            plugin_classname: ZenPacks.community.ISAM.dsplugins.ISAMInterface.ISAMInterface

            datapoints:
              inbound:
                rrdtype: GAUGE
              outbound:
                rrdtype: GAUGE

        graphs:
          Bandwidth:
            height: 100
            width: 1000
            units: bits/s
            miny: 0

            graphpoints:
              inbound:
                dpName: interface_inbound
              outbound:
                dpName: interface_outbound

      ISAMFileSystem:
        datasources:
          filesystem:
            type: Python
            plugin_classname: ZenPacks.community.ISAM.dsplugins.ISAMFileSystem.ISAMFileSystem

            datapoints:
              size:
                rrdtype: GAUGE
              used:
                rrdtype: GAUGE
              used_perc:
                rrdtype: GAUGE

        graphs:
          FileSystem Used:
            width: 1000
            units: bytes
            base: true
            miny: 0

            graphpoints:
              used:
                dpName: filesystem_used
                lineType: AREA

          FileSystem Used Percentage:
            width: 1000
            units: percent
            miny: 0
            maxy: 100

            graphpoints:
              used:
                dpName: filesystem_used_perc
                lineType: AREA

class_relationships:
  - ISAMDevice 1:MC ISAMReverseProxy
  - ISAMDevice 1:MC ISAMInterface
  - ISAMDevice 1:MC ISAMFileSystem
  - ISAMReverseProxy 1:MC ISAMJunction
